## Replit Agent Workflow Rules (Read This First)

These rules exist so changes don't accidentally break the app or the Git history.

If you are Replit Agent (or any agent):
- Before making changes: read this section + the "Handoff Checklist" below and follow it exactly.
- Do not edit this file unless the user explicitly asks.

Hard rules:
- Replit workspace is the source of truth while building.
- Never push from a local machine. All `git push` must run inside the Replit workspace (SSH session or Replit shell).
- Do not commit secrets. Never commit `.env` or API keys. Use Replit Secrets.
- If `git push` prompts for username/password, STOP. That usually means `origin` is HTTPS or SSH key/deploy key is missing.

Branch + commit rules:
- Don't push to `main` for tiny edits. Prefer a branch for work-in-progress: `codex/<short-name>`.
- Only push to `main` after: `npm run verify` passes + restart the app + 60-second smoke test.
- Commit in meaningful chunks (not every keystroke).

Verify ritual:
- While iterating: `npm run verify:quick`
- Before pushing to `main`: `npm run verify`

---

# FirstUser

## Overview

FirstUser is a platform where founders create waitlist communities called "AppSpaces" and early users earn collectible badges based on their position in the waitlist. The application features a distinctive dark purple-themed design system with glass morphism effects, gradient accents, and ambient floating backgrounds.

## User Preferences

Preferred communication style: Simple, everyday language.

## System Architecture

### Frontend Architecture
- **Framework**: React 18 with TypeScript
- **Routing**: Wouter for lightweight client-side routing
- **State Management**: TanStack Query (React Query) for server state and caching
- **Styling**: Tailwind CSS v4 with custom design tokens defined in `@theme` blocks
- **UI Components**: shadcn/ui component library built on Radix UI primitives
- **Build Tool**: Vite with custom plugins for Replit integration

### Design System
The application implements a custom "FirstUser Design System" with:
- **Typography**: Inter for body text, Space Grotesk for headlines
- **Color Palette**: Deep void background (#0a0510) with violet/fuchsia accent gradients
- **Component Styling**: Glass morphism panels, gradient buttons, and animated ambient backgrounds
- **CSS Utilities**: Custom classes like `glass-panel`, `glass-input`, `btn-gradient`, `text-gradient`

### Backend Architecture
- **Runtime**: Node.js with Express 5
- **API Pattern**: RESTful JSON API with `/api` prefix
- **Database ORM**: Drizzle ORM with PostgreSQL
- **Schema Validation**: Zod with drizzle-zod integration for type-safe schemas
- **Session Management**: connect-pg-simple for PostgreSQL session storage

### Data Model
Three main entities:
1. **Users**: Authentication with username/email/password
2. **AppSpaces**: Waitlist communities created by founders with slug-based URLs
3. **WaitlistMembers**: Join records tracking position and badge tier (1st, 10^1, 10^2, 10^3, 10^4)

### Project Structure
```
client/src/         # React frontend
  components/ui/    # shadcn/ui components
  pages/            # Route components
  lib/              # Utilities, API client, auth hooks
server/             # Express backend
  routes.ts         # API endpoints
  storage.ts        # Database access layer
  db.ts             # Drizzle connection
shared/             # Shared types and schemas
  schema.ts         # Drizzle table definitions
```

### Build System
- Development: Vite dev server with HMR proxied through Express
- Production: esbuild bundles server code, Vite builds client to `dist/public`
- Database: `drizzle-kit push` for schema migrations

## External Dependencies

### Database
- **PostgreSQL**: Primary data store, connected via `DATABASE_URL` environment variable
- **Drizzle ORM**: Type-safe database queries and schema management

### UI Libraries
- **Radix UI**: Accessible primitive components (dialog, dropdown, tabs, etc.)
- **Lucide React**: Icon library
- **class-variance-authority**: Component variant management
- **Tailwind CSS**: Utility-first styling with custom theme configuration

### State & Data Fetching
- **TanStack Query**: Async state management and caching
- **Wouter**: Lightweight React router

### External Services
- **SendGrid**: Email delivery for verification codes (`SENDGRID_API_KEY` secret, used in `server/email.ts`)
- **Textbelt**: SMS delivery for phone verification codes (`TEXTBELT_API_KEY` secret, used in `server/sms.ts` and `server/routes.ts`)
- **EMAIL_FROM**: Optional env var to set sender address (defaults to `FirstUser <noreply@firstuser.app>`)
- **FOUNDER_PHONES**: Optional env var (Replit Secret) with comma-separated phone numbers that should be granted platform-level founder access (`hasFounderAccess`) on phone verification. This does not determine who owns an AppSpace; AppSpace ownership is `app_spaces.founder_id` (the user who created that community).
- **HOMEPAGE_OWNER_PHONE**: Optional env var for homepage ownership lock (recommended: `13477444249`). When set, only this verified phone account can create/manage the homepage slug and phone verification auto-transfers homepage ownership to that account.

### Development Tools
- **Vite**: Frontend build tool with React plugin
- **Replit Plugins**: Dev banner, cartographer, runtime error overlay
- **TypeScript**: Full type coverage across frontend and backend

## Handoff Checklist

For a generic, copy/pasteable setup guide (Replit source-of-truth + SSH push to GitHub), see `docs/REPLIT_SSH_GITHUB_WORKFLOW.md`.

Use this checklist whenever an agent starts or finishes work in this Replit workspace.

### 1) Confirm GitHub Push Will Work From SSH
- Run `git remote -v`
- `origin` must be SSH (example: `git@github.com:chriscarm/firstuserfinal.git`)

### 2) Confirm Branch + Working Tree
- Run `git status -sb`
- Make sure you are on the intended branch and the working tree is clean before starting a new chunk.

### 3) Run Checks
- Iterating fast: `npm run verify:quick`
- Before pushing to `main`: `npm run verify`

### 4) Restart + 60-Second Smoke Test
After pushing a meaningful change to `main`, restart the Replit app and sanity check:
- Logged out: click **Community Chat** from the FirstUser landing page
- Logged out: visit `/space/firstuser/community` and confirm the read-only preview works

### 5) Commit + Push (From SSH)
- `git add -A`
- `git commit -m "..."` (one meaningful chunk)
- `git push origin <branch>`

### Troubleshooting
If `git push` ever prompts for username/password, stop. `origin` is probably HTTPS or the SSH key is not configured in this workspace.
